name: "Poetry update"
description: "Poetry dependencies update"
inputs:
  reviewers:
    description: Comma seperated name of reviewers for created PR
    required: false
    default: ''
  dry_run:
    description: Dry run action, no pull request is created
    default: 'true'
    required: false
  top_level:
    description: Report only explicitly defined packages
    default: 'true'
    required: false
  working_directory:
    description: Working directory, defaults to GITHUB_WORKSPACE
    required: false
    default: ${{ github.workspace }}

  ssh_key:
    description: "SSH key to use for private repositories"
    required: false


runs:
  using: "composite"

  steps:
    - uses: moneymeets/action-setup-python-poetry@master
      with:
        working_directory: ${{ github.action_path }}
        with_checks: 'false'
        poetry_cache_enabled: 'false'

    - uses: moneymeets/action-setup-python-poetry@master
      with:
        working_directory: ${{ inputs.working_directory }}
        with_checks: 'false'
        poetry_cache_enabled: 'false'
        ssh_key: ${{ inputs.ssh_key }}

    - shell: bash
      run: |        
        echo "-----------------"
        
        cd  ${{ inputs.working_directory }} && pwd && poetry env info
        
        echo "-----------------"
        
        cd  ${{ inputs.working_directory }} && pwd && poetry env list
        
        echo "-----------------"
        
        cd  ${{ github.action_path }} && pwd && poetry env info
        
        echo "-----------------"
        
        cd  ${{ github.action_path }} && pwd && poetry env list
  
        echo "-----------------"
        
        cd  ${{ github.action_path }} && pwd && poetry run actions_helper dependency-update --revamp-dir ${{ inputs.working_directory }}
